(function($){virb.trigger=function(path,args){$(document).trigger(path,args);}
virb.log=function(){if(virb.config.debug){var args=Array.prototype.slice.call(arguments);try{log=Function.prototype.bind.call(console.log,console);log.apply(this,args);}catch(e){}}};String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1);};String.prototype.toUnderscore=function(){return this.replace(/([A-Z])/g,function($1){return"_"+$1.toLowerCase();}).slice(1);};String.prototype.toCamel=function(){return this.replace(/(\_[a-z])/g,function($1){return $1.toUpperCase().replace('_','');});};String.prototype.toClass=function(){return this.toCamel().capitalize();};String.prototype.pad=function(length){var str=''+this;while(str.length<length){str='0'+str;}
return str;};String.prototype.slugify=function(whitelist){var slug=this.replace(/ /g,'-').toLowerCase();if(!whitelist){var whitelist='-_\/';}
return slug.alphaNumeric(whitelist);};String.prototype.alphaNumeric=function(whitelist){var whitelistString="a-zA-Z0-9";if(whitelist){whitelistString+=whitelist;}
var regex=new RegExp("[^"+whitelistString+"]+","g");var text=this.replace(regex,'');return text;};String.prototype.truncate=function(length){var str=''+this;if(str.length>length){return str.substring(0,length)+'&hellip;';}
return str;};Number.prototype.pad=String.prototype.pad;Date.prototype.days={0:'Sunday',1:'Monday',2:'Tuesday',3:'Wednesday',4:'Thursday',5:'Friday',6:'Saturday'};Date.prototype.months={0:'January',1:'February',2:'March',3:'April',4:'May',5:'June',6:'July',7:'August',8:'September',9:'October',10:'November',11:'December'};Date.prototype.setFromAtom=function(atom){var atomSplit=atom.split('T');var dateSplit=atomSplit[0].split('-');var timeOffsetSplit=atomSplit[1].split('+');if(!timeOffsetSplit[1])
timeOffsetSplit=atomSplit[1].split('-');var timeSplit=timeOffsetSplit[0].substr(0,8).split(':');var timezone=timeOffsetSplit[1];this.setDateTime(dateSplit[0],dateSplit[1],dateSplit[2],timeSplit[0],timeSplit[1],timeSplit[2]);return this;};Date.prototype.setFromISO=function(iso){var isoSplit=iso.split(' ');var dateSplit=isoSplit[0].split('-');var timeSplit=isoSplit[1].split(':');var timezone=isoSplit[2];this.setDateTime(dateSplit[0],dateSplit[1],dateSplit[2],timeSplit[0],timeSplit[1],timeSplit[2]);return this;};Date.prototype.setFromYMD=function(date){var dateSplit=date.split('-');this.setDateTime(dateSplit[0],dateSplit[1],dateSplit[2]);return this;};Date.prototype.setDateTime=function(year,month,day,hours,minutes,seconds,milliseconds){if(year){this.setFullYear(year);}
if(month){this.setMonth(month-1);}
if(day){this.setDate(day);}
if(hours){this.setHours(hours);}
if(minutes){this.setMinutes(minutes);}
if(seconds){this.setSeconds(seconds);}
if(milliseconds){this.setMilliseconds(milliseconds);}};Date.prototype.setReplacements=function(){var self=this;this.replacements={D:self.days[self.getDay()].slice(0,3),d:self.getDate().pad(2),j:self.getDate(),l:self.days[self.getDay()],F:self.months[self.getMonth()],M:self.months[self.getMonth()].slice(0,3),m:(self.getMonth()+1).pad(2),n:self.getMonth()+1,Y:self.getFullYear(),y:self.getFullYear().toString().slice(-2),G:self.getHours(),H:function(){var hours=self.getHours();if(hours>12){hours=hours-12;}
return hours.pad(2);},g:function(){var hours=self.getHours();if(hours>12){hours=hours-12;}
return hours;},i:self.getMinutes().pad(2),s:self.getSeconds(),a:self.getMeridiem(),A:self.getMeridiem().toUpperCase()};};Date.prototype.format=function(format){this.setReplacements();var formattedString='';for(var i=0;i<format.length;i++){var newCharacter=character=format.charAt(i);$.each(this.replacements,function(index,value){if(character.search(index)>=0){if(typeof value=='function'){newCharacter=character.replace(index,value());}else{newCharacter=character.replace(index,value);}}});formattedString+=newCharacter;}
return formattedString;};Date.prototype.getMeridiem=function(){if(this.getHours()>11){return'pm';}else{return'am';}};var Crumbnav=function(){return this.each(function(){Crumbnav.init($(this));});};Crumbnav.init=function($navObj){this.selectedIndex=0;this.objs={navObj:$navObj,listObj:$navObj.find('li,'),linkObj:$navObj.find('li').find('a')};this.currentHash=false;this.objs.linkObj.each(function(i){$(this).attr('index',i);});this.hashInterval=setInterval(function(){Crumbnav.parseHash();},100);};Crumbnav.parseHash=function(args){var theHash=window.location.hash;if(theHash!==this.currentHash){var isDefault=true;if(theHash!=''){this.objs.linkObj.each(function(){var $this=$(this);if(theHash==$this.attr('href')){Crumbnav.selectSection($this);isDefault=false;}});}
if(isDefault)
Crumbnav.selectSectionByIndex(0);}};Crumbnav.selectSectionByIndex=function(index){this.selectSection(this.objs.navObj.find('li:eq('+index+') a'));};Crumbnav.selectSection=function($clickObj){if(window.location.hash!=='')
window.location.hash=$clickObj.attr('href');this.currentHash=window.location.hash;var visible='';var visibleSectionId=false;this.selectedIndex=$clickObj.attr('index');var clickSectionId=$clickObj.attr('href').replace('#','')+'_section';this.objs.listObj.removeClass('selected').removeClass('prev');this.objs.navObj.find('li:eq('+this.selectedIndex+')').addClass('selected').prev().addClass('prev');this.objs.linkObj.each(function(){var $this=$(this);var sectionId=$this.attr('href').replace('#','')+'_section';if($('#'+sectionId).is(':visible')){visible=$('#'+sectionId).get(0);visibleSectionId=sectionId;}});if(this.objs.navObj.parent('dd').parent('dl').length){var $dtObj=this.objs.navObj.parent('dd').parent('dl').find('dt');if(this.selectedIndex!=0)
$dtObj.addClass('alt');else
$dtObj.removeClass('alt');}
var $showIframe=$('#'+clickSectionId+' iframe');$showIframe.attr('src',$showIframe.attr('title'));$('#'+clickSectionId).fadeIn();if(visibleSectionId&&visibleSectionId!=clickSectionId)
$(visible).hide().find('iframe').attr('src','');};window.virb.$.fn.crumbnav=Crumbnav;$('select.show-hide').live('change',function(){$(this).selectShowHide();return false;});virb.$.fn.selectShowHide=function(args)
{return this.each(function()
{var select=$(this),togglees=$('[data-toggle="'+select.attr('id')+'"]');togglees.each(function(){if($(this).attr('data-toggle-on')){var toggleOnArray=$(this).attr('data-toggle-on').split(","),show=false;for(var i=0;i<toggleOnArray.length;i++){if(select.find('option:selected').val().toString()==toggleOnArray[i]){show=true;}}
if(show){$(this).show();}else{$(this).hide();}}});});}
$('a.slider').bind('click',function(event){event.preventDefault();$(this).toggleSlider();});virb.$.fn.toggleSlider=function(args)
{return this.each(function()
{var $this=$(this);var transition='fade';var direction='In'
if($this.data('transition')){transition=$this.data('transition');}
if($this.data('status')=='on'||(args&&args.close)){$this.removeClass('on').addClass('off').data('status','off');}else{$this.removeClass('off').addClass('on').data('status','on');}
if($this.data('status')=='on'&&$this.data('toggle')){if(transition=='slide'){direction='Down';}
$($this.data('toggle'))[transition+direction]();}else if($this.data('status')=='off'&&$this.data('toggle')){if(transition=='slide'){direction='Up';}else{direction='Out';}
$($this.data('toggle'))[transition+direction]();}
if($this.data('input')&&$this.data('submit')){if($this.data('status')=='on'||(args&&args.close)){$this.data('submit','yes');}
else{$this.data('submit','no');}
$('[name="'+$this.data('input')+'"]').val($this.data('submit'));}});};$('div.drawer h5 a').live('click',function(){var $drawer=$(this).closest('div.drawer');var $clothes=$drawer.find('.clothes');if($drawer.hasClass('closed')){$clothes.slideDown();$drawer.removeClass('closed').addClass('open');}else{$clothes.slideUp(function(){$drawer.removeClass('open').addClass('closed');});}
return false;});$('.expand').live('click',function(){var $this=$(this);if($this.hasClass('on')){$this.removeClass('on').addClass('off');$($this.attr('target')).slideDown();}else{$this.removeClass('off').addClass('on');$($this.attr('target')).slideUp();}});var $infoTipWrap=virb.$('<div id="info-tip-wrap"><div id="info-tip"><div class="arrow-right"></div></div></div>').hide();$infoTipWrap.appendTo('body');$infoTip=$infoTipWrap.find('#info-tip');virb.$('[data-info]').live('mouseover',function(){var $this=$(this);var info=$this.attr('data-info');var offset=$this.offset();var offsetTop=0;var offsetLeft=0;_gaq.push(['_trackEvent','Info Tips','View',info]);if($this.hasClass('mini')){$infoTipWrap.addClass('mini');}else{$infoTipWrap.removeClass('mini');}
$infoTip.html(info);if($this.hasClass('left')){$arrow=$('<div class="arrow-left"></div>');}else if($this.hasClass('right')){$arrow=$('<div class="arrow-right"></div>');}else if($this.hasClass('bottom')){$arrow=$('<div class="arrow-bottom"></div>');}else if($this.hasClass('top')){$arrow=$('<div class="arrow-top"></div>');}
$arrow.prependTo($infoTip);var outerHeight=$infoTipWrap.outerHeight();var height=$infoTipWrap.height();var width=$infoTipWrap.width();if($this.hasClass('left')){offsetLeft=$this.outerWidth()+10;offsetTop=-outerHeight/2+$this.height()/2;$arrow.css({top:(height/2-5)+'px'}).prependTo($infoTip);}else if($this.hasClass('right')){offsetLeft=-$infoTipWrap.outerWidth()-10;offsetTop=-outerHeight/2+$this.height()/2;$arrow.css({top:(height/2-5)+'px'});}else if($this.hasClass('top')){offsetLeft=-$infoTipWrap.outerWidth()/2+$this.width()/2;offsetTop=0;$arrow.css({left:(width/2-5)+'px'}).prependTo($infoTip);}else if($this.hasClass('bottom')){offsetLeft=-$infoTipWrap.outerWidth()/2+$this.width()/2;offsetTop=-outerHeight-10;$arrow.css({left:(width/2-5)+'px'}).prependTo($infoTip);}
$infoTipWrap.css({top:offset.top+offsetTop,left:offset.left+offsetLeft})
$infoTipWrap.fadeIn('fast');}).live('mouseout',function(){$infoTipWrap.hide();});virb.$.getUID=function(){var uid='';for(i=0;i<32;i++){uid+=Math.floor(Math.random()*16).toString(16);}
return uid;};virb.$.preventNav=function(invoke,message){if(typeof invoke!=='boolean'){throw new Error('virb.$.preventNav: First argument needs to be a boolean');}
if(invoke===false){window.onbeforeunload=function(){};return true;}
else
{if(!message){var message='If so, your changes will be lost.';}
window.onbeforeunload=function(evt){e=window.event?window.event:evt;e.returnValue=message;return message;};}};virb.$.encodeHTML=function(text,args){if(!args||!args.noAmp){text=text.replace(/&(?!amp;)/ig,'&amp;');}
if(!args||!args.noEncodeURI){text=encodeURIComponent(text);}
if(!args||!args.noEscape)
text=escape(text);return text;};virb.$.decodeHTML=function(text){return unescape(decodeURIComponent(text));};virb.$.getHref=function(removeHash){var href=window.location.href;if(removeHash){href=href.replace(window.location.hash,'');href=href.replace(/#/g,'');}
return href;};virb.$.preload=function(images){imageObj=new Image(35,35);imageArray=[];if(typeof images==='object'){for(var i=0;i<images.length;i++){imageObj.src=images[i];imageArray.push(imageObj);}}
else
{imageObj.src=images;imageArray.push(imageObj);}};virb.$.callback=function(callback,response){if(callback){if(!response)
var response='';try
{window[callback](response);}
catch(err){var fn=new Function("response","return "+callback+"(response);");fn(response);}}};virb.$.getDimensions=function(html){heightReg=/height=[\"\']([0-9]+)[\"\']/gi;widthReg=/width=[\"\']([0-9]+)[\"\']/gi;var heightMatches=heightReg.exec(html);var widthMatches=widthReg.exec(html);if(widthMatches!=null&&heightMatches!=null){return{height:heightMatches[1],width:widthMatches[1]}}
return false;};virb.$.canResize=function(html){var dimensions=virb.$.getDimensions(html);if(false==dimensions)
return false;return true;}
virb.$.resize=function(html,args){if(virb.$.canResize(html)){var dimensions=virb.$.getDimensions(html);var width=575;var height='';if(args&&args.width){width=args.width;}
if(args&&args.height){height=args.height;}
height=Math.ceil((width*dimensions.height)/dimensions.width);heightReg=/height=[\"\']([0-9]+)[\"\']/gi;widthReg=/width=[\"\']([0-9]+)[\"\']/gi;html=html.replace(heightReg,'height="'+height+'"');html=html.replace(widthReg,'width="'+width+'"');}
return html;};virb.$.submitAjax=function(dataString,args){var type='POST';var url='/services/ajax/post';var dataType='json';var fail=virb.$.overlay.ajaxMessage;var getParams=dataString;if(args&&args.type&&args.type=='get'){type='GET';url='/services/ajax/get';}
if(args&&args.dataType)
dataType=args.dataType;if(args&&args.url)
url=args.url;if(typeof dataString=='object'){getParams='';$.each(dataString.params,function(index,value){getParams+='data['+dataString.model+']['+index+']='+value+'&';});}
virb.log(getParams);virb.$.ajax({"type":type,"url":url,data:getParams,"dataType":dataType,success:function(result){$.each(result,function(index,value){if(result[index].stat=='ok'){args.ok(value);}else{if(args.fail){args.fail(value);}else{fail('error',value.message);}}});}});};$.fn.attachSelect=function(){return this.each(function(){var $this=$(this);$this.prev().html('<span>'+$this.find('option:selected').html()+'</span>');$this.change(function(){var $this=$(this);$this.prev().html('<span>'+$this.find('option:selected').html()+'</span>');});});};$.fn.attachTitleInside=function(){return this.each(function(){var $this=$(this);$.data(this,'title',$this.attr('title'));if($this.val()==''){$this.val($.data(this,'title'));}
else if($this.val()!=$.data(this,'title')){if($this.attr('type')!='password')
$this.attr('title',$this.val());$this.addClass('focus');}
$this.unbind('focus').focus(function(event){var $this=$(this);if(!$this.hasClass('focus'))
$this.addClass('focus');if($this.val()==$.data(this,'title'))
$this.val('');});$this.unbind('blur').blur(function(event){var $this=$(this);if($this.val()==''){$this.removeClass('focus');$this.val($.data(this,'title'));}
if($this.attr('type')!='password')
$this.attr('title',$this.val());});});};$('.titleinside').attachTitleInside();$.fn.updateTitleInside=function(newTitle){return this.each(function(){var oldTitle=$.data(this,'title');$.data(this,'title',newTitle);if(this.value==oldTitle||this.value==''){this.value=newTitle;}});};$.fn.showTitleInside=function(){return this.each(function(){if(this.value=='')
this.value=$.data(this,'title');});};$.fn.hideTitleInside=function(){return this.each(function(){if(this.value==$.data(this,'title'))
this.value='';});};virb.$.fn.attachTitleInside=$.fn.attachTitleInside;virb.$.fn.showTitleInside=$.fn.showTitleInside;virb.$.fn.hideTitleInside=$.fn.hideTitleInside;$.fn.changeInputType=function(oType){return this.each(function(){var newObject=document.createElement('input');newObject.type=oType;if(this.size)
newObject.size=this.size;if(this.value)
newObject.value=this.value;if(this.name)
newObject.name=this.name;if(this.id)
newObject.id=this.id;if(this.title)
newObject.title=this.title;if(this.tabIndex)
newObject.tabIndex=this.tabIndex;if(this.className)
newObject.className=this.className;this.parentNode.replaceChild(newObject,this);return virb.$(newObject);});};virb.$.fn.changeInputType=$.fn.changeInputType;virb.$.alphaNumeric=function(text,whitelist){var whitelistString="a-zA-Z0-9";if(whitelist){whitelistString+=whitelist;}
var regex=new RegExp("[^"+whitelistString+"]+","g");text=text.replace(regex,'');return text;};virb.$.slugify=function(text){var slug=text.replace(/ /g,'-').toLowerCase();return $.alphaNumeric(slug,'-_\/');};virb.$.removeWhitespace=function(text){return text.replace(/ /g,'');};virb.$.getFlashMovie=function(movieName){var isIE=navigator.appName.indexOf("Microsoft")!=-1;flashMovie=(isIE)?window[movieName]:document[movieName];return flashMovie;};})(virb.$);;(function($){var methods={init:function(options){var form=this;if(form.data('jqv')===undefined||form.data('jqv')==null){methods._saveOptions(form,options);virb.$(".formError").live("click",function(){virb.$(this).fadeOut(150,function(){virb.$(this).remove();});});}},attach:function(userOptions){var form=this;var options;if(userOptions)
options=methods._saveOptions(form,userOptions);else
options=form.data('jqv');if(!options.binded){if(options.bindMethod=="bind"){form.find("[class*=validate]").not("[type=checkbox]").bind(options.validationEventTrigger,methods._onFieldEvent);form.find("[class*=validate][type=checkbox]").bind("click",methods._onFieldEvent);form.bind("submit",methods._onSubmitEvent);}else if(options.bindMethod=="live"){form.find("[class*=validate]").not("[type=checkbox]").live(options.validationEventTrigger,methods._onFieldEvent);form.find("[class*=validate][type=checkbox]").live("click",methods._onFieldEvent);form.live("submit",methods._onSubmitEvent);}
options.binded=true;}},detach:function(){var form=this;var options=form.data('jqv');if(options.binded){form.find("[class*=validate]").not("[type=checkbox]").unbind(options.validationEventTrigger,methods._onFieldEvent);form.find("[class*=validate][type=checkbox]").unbind("click",methods._onFieldEvent);form.unbind("submit",methods.onAjaxFormComplete);form.find("[class*=validate]").not("[type=checkbox]").die(options.validationEventTrigger,methods._onFieldEvent);form.find("[class*=validate][type=checkbox]").die("click",methods._onFieldEvent);form.die("submit",methods.onAjaxFormComplete);form.removeData('jqv');}},validate:function(){return methods._validateFields(this);},validateField:function(el){var options=virb.$(this).data('jqv');return methods._validateField(virb.$(el),options);},validateform:function(){return methods._onSubmitEvent(this);},showPrompt:function(promptText,type,promptPosition,showArrow){var form=this.closest('form');var options=form.data('jqv');if(!promptPosition)
options.promptPosition=promptPosition;options.showArrow=showArrow===true;methods._showPrompt(this,promptText,type,false,options);},hidePrompt:function(){var promptClass="."+virb.$(this).attr("id")+"formError"
virb.$(promptClass).fadeTo("fast",0.3,function(){virb.$(this).remove();});},hide:function(){var form=this;form.find('.formError').fadeTo("fast",0.3,function(){virb.$(this).remove();});},hideAll:function(){virb.$('.formError').fadeTo("fast",0.3,function(){virb.$(this).remove();});},_onFieldEvent:function(){var field=virb.$(this);var form=field.closest('form');var options=form.data('jqv');methods._validateField(field,options);},_onSubmitEvent:function(){var form=virb.$(this);var r=methods._validateFields(form,true);var options=form.data('jqv');if(r&&options.ajaxFormValidation){methods._validateFormWithAjax(form,options);return false;}
if(options.onValidationComplete){options.onValidationComplete(form,r);return false;}
return r;},_checkAjaxStatus:function(options){var status=true;virb.$.each(options.ajaxValidCache,function(key,value){if(value===false){status=false;return false;}});return status;},_validateFields:function(form,skipAjaxFieldValidation){var options=form.data('jqv');var errorFound=false;form.find('[class*=validate]').not(':hidden').each(function(){var field=virb.$(this);if(!field.hasClass("ajaxed"))
errorFound|=methods._validateField(field,options,skipAjaxFieldValidation);});errorFound|=!methods._checkAjaxStatus(options);if(errorFound){if(options.scroll){var destination=Number.MAX_VALUE;var lst=virb.$(".formError:not('.greenPopup')");for(var i=0;i<lst.length;i++){var d=virb.$(lst[i]).offset().top;if(d<destination)
destination=d;}
if(!options.isOverflown)
virb.$("html:not(:animated),body:not(:animated)").animate({scrollTop:destination},1100);else{var overflowDIV=virb.$(options.overflownDIV);var scrollContainerScroll=overflowDIV.scrollTop();var scrollContainerPos=-parseInt(overflowDIV.offset().top);destination+=scrollContainerScroll+scrollContainerPos-5;var scrollContainer=virb.$(options.overflownDIV+":not(:animated)");scrollContainer.animate({scrollTop:destination},1100);}}
return false;}
return true;},_validateFormWithAjax:function(form,options){var data=form.serialize();virb.$.ajax({type:"GET",url:form.attr("action"),cache:false,dataType:"json",data:data,form:form,methods:methods,options:options,beforeSend:function(){return options.onBeforeAjaxFormValidation(form,options);},error:function(data,transport){methods._ajaxError(data,transport);},success:function(json){if(json!==true){var errorInForm=false;for(var i=0;i<json.length;i++){var value=json[i];var errorFieldId=value[0];var errorField=virb.$(virb.$("#"+errorFieldId)[0]);if(errorField.length==1){var msg=value[2];if(value[1]===true){if(msg=="")
methods._closePrompt(errorField);else{if(options.allrules[msg]){var txt=options.allrules[msg].alertTextOk;if(txt)
msg=txt;}
methods._showPrompt(errorField,msg,"pass",false,options);}}else{errorInForm|=true;if(options.allrules[msg]){var txt=options.allrules[msg].alertText;if(txt)
msg=txt;}
methods._showPrompt(errorField,msg,"",false,options);}}}
options.onAjaxFormComplete(!errorInForm,form,json,options);}else
options.onAjaxFormComplete(true,form,"",options);}});},_validateField:function(field,options,skipAjaxFieldValidation){if(!field.attr("id"))
virb.$.error("jQueryValidate: an ID attribute is required for this field: "+field.attr("name")+" class:"+
field.attr("class"));var rulesParsing=field.attr('class');var getRules=/\[(.*)\]/.exec(rulesParsing);if(getRules===null)
return false;var str=getRules[1];var rules=str.split(/\[|,|\]/);var isAjaxValidator=false;var fieldName=field.attr("name");var promptText="";var required=false;options.isError=false;options.showArrow=true;for(var i=0;i<rules.length;i++){var errorMsg=undefined;switch(rules[i]){case"required":required=true;errorMsg=methods._required(field,rules,i,options);break;case"custom":errorMsg=methods._customRegex(field,rules,i,options);break;case"ajax":if(!skipAjaxFieldValidation){methods._ajax(field,rules,i,options);isAjaxValidator=true;}
break;case"minSize":errorMsg=methods._minSize(field,rules,i,options);break;case"maxSize":errorMsg=methods._maxSize(field,rules,i,options);break;case"min":errorMsg=methods._min(field,rules,i,options);break;case"max":errorMsg=methods._max(field,rules,i,options);break;case"past":errorMsg=methods._past(field,rules,i,options);break;case"future":errorMsg=methods._future(field,rules,i,options);break;case"maxCheckbox":errorMsg=methods._maxCheckbox(field,rules,i,options);field=virb.$(virb.$("input[name='"+fieldName+"']"));break;case"minCheckbox":errorMsg=methods._minCheckbox(field,rules,i,options);field=virb.$(virb.$("input[name='"+fieldName+"']"));break;case"equals":errorMsg=methods._equals(field,rules,i,options);break;case"funcCall":errorMsg=methods._funcCall(field,rules,i,options);break;default:}
if(errorMsg!==undefined){promptText+=errorMsg+"<br/>";options.isError=true;}}
if(!required){if(field.val()=="")options.isError=false;}
var fieldType=field.attr("type");if((fieldType=="radio"||fieldType=="checkbox")&&virb.$("input[name='"+fieldName+"']").size()>1){field=virb.$(virb.$("input[name='"+fieldName+"'][type!=hidden]:first"));options.showArrow=false;}
if(!isAjaxValidator){if(options.isError)
methods._showPrompt(field,promptText,"",false,options);else
methods._closePrompt(field);}
return options.isError;},_required:function(field,rules,i,options){switch(field.attr("type")){case"text":case"password":case"textarea":if(!field.val())
return options.allrules[rules[i]].alertText;break;case"radio":case"checkbox":var name=field.attr("name");if(virb.$("input[name='"+name+"']:checked").size()===0){if(virb.$("input[name='"+name+"']").size()===1)
return options.allrules[rules[i]].alertTextCheckboxe;else
return options.allrules[rules[i]].alertTextCheckboxMultiple;}
break;case"select-one":if(!field.val())
return options.allrules[rules[i]].alertText;break;case"select-multiple":if(!field.find("option:selected").val())
return options.allrules[rules[i]].alertText;break;}},_customRegex:function(field,rules,i,options){var customRule=rules[i+1];var pattern=new RegExp(options.allrules[customRule].regex);if(!pattern.test(field.attr('value')))
return options.allrules[customRule].alertText;},_funcCall:function(field,rules,i,options){var functionName=rules[i+1];var fn=window[functionName];if(typeof(fn)==='function')
return fn(field,rules,i,options);},_equals:function(field,rules,i,options){var equalsField=rules[i+1];if(field.attr('value')!=virb.$("#"+equalsField).attr('value'))
return options.allrules.equals.alertText;},_maxSize:function(field,rules,i,options){var max=rules[i+1];var len=field.attr('value').length;if(len>max){var rule=options.allrules.maxSize;return rule.alertText+max+rule.alertText2;}},_minSize:function(field,rules,i,options){var min=rules[i+1];var len=field.attr('value').length;if(len<min){var rule=options.allrules.minSize;return rule.alertText+min+rule.alertText2;}},_min:function(field,rules,i,options){var min=parseFloat(rules[i+1]);var len=parseFloat(field.attr('value'));if(len<min){var rule=options.allrules.min;return rule.alertText+min;}},_max:function(field,rules,i,options){var max=parseFloat(rules[i+1]);var len=parseFloat(field.attr('value'));if(len>max){var rule=options.allrules.max;return rule.alertText+max;}},_past:function(field,rules,i,options){var p=rules[i+1];var pdate=(p.toLowerCase()=="now")?new Date():methods._parseDate(p);var vdate=methods._parseDate(field.attr('value'));if(vdate>pdate){var rule=options.allrules.past;return rule.alertText+methods._dateToString(pdate);}},_future:function(field,rules,i,options){var p=rules[i+1];var pdate=(p.toLowerCase()=="now")?new Date():methods._parseDate(p);var vdate=methods._parseDate(field.attr('value'));if(vdate<pdate){var rule=options.allrules.future;return rule.alertText+methods._dateToString(pdate);}},_maxCheckbox:function(field,rules,i,options){var nbCheck=rules[i+1];var groupname=field.attr("name");var groupSize=virb.$("input[name='"+groupname+"']:checked").size();if(groupSize>nbCheck){options.showArrow=false;return options.allrules.maxCheckbox.alertText;}},_minCheckbox:function(field,rules,i,options){var nbCheck=rules[i+1];var groupname=field.attr("name");var groupSize=virb.$("input[name='"+groupname+"']:checked").size();if(groupSize<nbCheck){options.showArrow=false;return options.allrules.minCheckbox.alertText+" "+nbCheck+" "+
options.allrules.minCheckbox.alertText2;}},_ajax:function(field,rules,i,options){var errorSelector=rules[i+1];var rule=options.allrules[errorSelector];var extraData=rule.extraData;if(!extraData)
extraData="";if(!options.isError){virb.$.ajax({type:"GET",url:rule.url,cache:false,dataType:"json",data:"fieldId="+field.attr("id")+"&fieldValue="+field.attr("value")+"&extraData="+extraData,field:field,rule:rule,methods:methods,options:options,beforeSend:function(){var loadingText=rule.alertTextLoad;if(loadingText)
methods._showPrompt(field,loadingText,"load",true,options);},error:function(data,transport){methods._ajaxError(data,transport);},success:function(json){var errorFieldId=json[0];var errorField=virb.$(virb.$("#"+errorFieldId)[0]);if(errorField.length==1){var status=json[1];if(status===false){options.ajaxValidCache[errorFieldId]=false;options.isError=true;var promptText=rule.alertText;methods._showPrompt(errorField,promptText,"",true,options);}else{if(options.ajaxValidCache[errorFieldId]!==undefined)
options.ajaxValidCache[errorFieldId]=true;var alertTextOk=rule.alertTextOk;if(alertTextOk)
methods._showPrompt(errorField,alertTextOk,"pass",true,options);else
methods._closePrompt(errorField);}}}});}},_ajaxError:function(data,transport){if(data.status===0&&transport===null)
alert("The page is not served from a server! ajax call failed");else if(console)
console.log("Ajax error: "+data.status+" "+transport);},_dateToString:function(date){return date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate();},_parseDate:function(d){var dateParts=d.split("-");if(dateParts!==d)
dateParts=d.split("/");return new Date(dateParts[0],(dateParts[1]-1),dateParts[2]);},_showPrompt:function(field,promptText,type,ajaxed,options){var prompt=methods._getPrompt(field);if(prompt)
methods._updatePrompt(field,prompt,promptText,type,ajaxed,options);else
methods._buildPrompt(field,promptText,type,ajaxed,options);},_buildPrompt:function(field,promptText,type,ajaxed,options){var prompt=virb.$('<div>');prompt.addClass(field.attr("id")+"formError");prompt.addClass("formError");switch(type){case"pass":prompt.addClass("greenPopup");break;case"load":prompt.addClass("blackPopup");}
if(ajaxed)
prompt.addClass("ajaxed");var promptContent=virb.$('<div>').addClass("formErrorContent").html(promptText).appendTo(prompt);if(options.showArrow){var arrow=virb.$('<div>').addClass("formErrorArrow");switch(options.promptPosition){case"bottomLeft":case"bottomRight":prompt.find(".formErrorContent").before(arrow);arrow.addClass("formErrorArrowBottom").html('<div class="line1"><!-- --></div><div class="line2"><!-- --></div><div class="line3"><!-- --></div><div class="line4"><!-- --></div><div class="line5"><!-- --></div><div class="line6"><!-- --></div><div class="line7"><!-- --></div><div class="line8"><!-- --></div><div class="line9"><!-- --></div><div class="line10"><!-- --></div>');break;case"topLeft":case"topRight":arrow.html('<div class="line10"><!-- --></div><div class="line9"><!-- --></div><div class="line8"><!-- --></div><div class="line7"><!-- --></div><div class="line6"><!-- --></div><div class="line5"><!-- --></div><div class="line4"><!-- --></div><div class="line3"><!-- --></div><div class="line2"><!-- --></div><div class="line1"><!-- --></div>');arrow.addClass('formErrorArrowLeft');prompt.append(arrow);break;}}
if(options.isOverflown)
field.before(prompt);else
virb.$("body").append(prompt);var pos=methods._calculatePosition(field,prompt,options);prompt.css({"top":pos.callerTopPosition,"left":pos.callerleftPosition,"marginTop":pos.marginTopSize,"opacity":0});return prompt.animate({"opacity":0.95});},_updatePrompt:function(field,prompt,promptText,type,ajaxed,options){if(prompt){if(type=="pass")
prompt.addClass("greenPopup");else
prompt.removeClass("greenPopup");if(type=="load")
prompt.addClass("blackPopup");else
prompt.removeClass("blackPopup");if(ajaxed)
prompt.addClass("ajaxed");else
prompt.removeClass("ajaxed");prompt.find(".formErrorContent").html(promptText);var pos=methods._calculatePosition(field,prompt,options);prompt.animate({"top":pos.callerTopPosition,"marginTop":pos.marginTopSize});}},_closePrompt:function(field){var prompt=methods._getPrompt(field);if(prompt)
prompt.fadeTo("fast",0,function(){prompt.remove();});},_getPrompt:function(field){var className="."+field.attr("id")+"formError";var match=virb.$(className)[0];if(match)
return virb.$(match);},_calculatePosition:function(field,promptElmt,options){var promptTopPosition,promptleftPosition,marginTopSize;var fieldWidth=field.width();var promptHeight=promptElmt.height();var overflow=options.isOverflown;if(overflow){promptTopPosition=promptleftPosition=0;marginTopSize=-promptHeight;}else{var offset=field.offset();promptTopPosition=offset.top;promptleftPosition=offset.left;marginTopSize=0;}
switch(options.promptPosition){default:case"topRight":if(overflow)
promptleftPosition+=fieldWidth-30;else{promptleftPosition+=fieldWidth-30;promptTopPosition+=-promptHeight;}
break;case"topLeft":promptTopPosition+=-promptHeight-10;break;case"centerRight":promptleftPosition+=fieldWidth+13;break;case"bottomLeft":promptTopPosition=promptTopPosition+field.height()+15;break;case"bottomRight":promptleftPosition+=fieldWidth-30;promptTopPosition+=field.height()+5;}
return{"callerTopPosition":promptTopPosition+"px","callerleftPosition":promptleftPosition+"px","marginTopSize":marginTopSize+"px"};},_saveOptions:function(form,options){if(virb.$.validationEngineLanguage)
var allRules=virb.$.validationEngineLanguage.allRules;else
virb.$.error("jQuery.validationEngine rules are not loaded, plz add localization files to the page");var userOptions=virb.$.extend({validationEventTrigger:"blur",scroll:true,promptPosition:"topRight",bindMethod:"bind",ajaxFormValidation:false,onAjaxFormComplete:virb.$.noop,onBeforeAjaxFormValidation:virb.$.noop,onValidationComplete:false,isOverflown:false,overflownDIV:"",allrules:allRules,binded:false,showArrow:true,isError:false,ajaxValidCache:{}},options);form.data('jqv',userOptions);return userOptions;}};virb.$.fn.validationEngine=function(method){var form=virb.$(this);if(!form[0])return false;if(typeof(method)==='string'&&method.charAt(0)!='_'&&methods[method]){methods.init.apply(form);return methods[method].apply(form,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){methods.init.apply(form,arguments);return methods.attach.apply(form);}else{virb.$.error('Method '+method+' does not exist in jQuery.validationEngine');}};})(jQuery);(function($){virb.$.fn.validationEngineLanguage=function(){};virb.$.validationEngineLanguage={newLang:function(){virb.$.validationEngineLanguage.allRules={"required":{"regex":"none","alertText":"This field is required","alertTextCheckboxMultiple":"Please select an option","alertTextCheckboxe":"This checkbox is required"},"minSize":{"regex":"none","alertText":"Minimum ","alertText2":" characters allowed"},"maxSize":{"regex":"none","alertText":"Maximum ","alertText2":" characters allowed"},"min":{"regex":"none","alertText":"Minimum value is "},"max":{"regex":"none","alertText":"Maximum value is "},"past":{"regex":"none","alertText":"Date prior to "},"future":{"regex":"none","alertText":"Date past "},"maxCheckbox":{"regex":"none","alertText":"Checks allowed Exceeded"},"minCheckbox":{"regex":"none","alertText":"Please select ","alertText2":" options"},"equals":{"regex":"none","alertText":"Fields do not match"},"phone":{"regex":/^([\+][0-9]{1,3}[ \.\-])?([\(]{1}[0-9]{2,6}[\)])?([0-9 \.\-\/]{3,20})((x|ext|extension)[ ]?[0-9]{1,4})?$/,"alertText":"Invalid phone number"},"email":{"regex":/^([A-Za-z0-9_\-\.\'])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,6})$/,"alertText":"Invalid email address"},"integer":{"regex":/^[\-\+]?\d+$/,"alertText":"Not a valid integer"},"number":{"regex":/^[\-\+]?(([0-9]+)([\.,]([0-9]+))?|([\.,]([0-9]+))?)$/,"alertText":"Invalid floating decimal number"},"date":{"regex":/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/,"alertText":"Invalid date, must be in YYYY-MM-DD format"},"ipv4":{"regex":/^([1-9][0-9]{0,2})+\.([1-9][0-9]{0,2})+\.([1-9][0-9]{0,2})+\.([1-9][0-9]{0,2})+$/,"alertText":"Invalid IP address"},"url":{"regex":/^(https?|ftp|feed):\/\/(((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/,"alertText":"Invalid URL"},"onlyNumberSp":{"regex":/^[0-9\ ]+$/,"alertText":"Numbers only"},"onlyLetterSp":{"regex":/^[a-zA-Z\ \']+$/,"alertText":"Letters only"},"onlyLetterNumber":{"regex":/^[0-9a-zA-Z]+$/,"alertText":"No special characters allowed"},"ajaxLink":{"url":"/services/ajax/post",'extraData':'&data[Page][action]=validateLinkGet',"alertTextLoad":"Checking site availability","alertText":"This site is already taken"},"ajaxEmail":{"url":"/services/ajax/post",'extraData':'&data[User][action]=validateEmail',"alertTextLoad":"Checking if email is in use","alertText":"This email is already taken"},"ajaxName":{"url":"validateUser.php","alertText":"This name is already taken","alertTextOk":"This name is available","alertTextLoad":"Loading, please wait"},"ajaxPageLink":{"url":"/services/ajax/validate/pageLink","alertText":"This link is already being used","alertTextLoad":"Checking if link is unique"},"ajaxUserCall":{"url":"ajaxValidateFieldUser","extraData":"name=eric","alertText":"This user is already taken","alertTextLoad":"Validating, please wait"},"ajaxNameCall":{"url":"ajaxValidateFieldName","alertText":"This name is already taken","alertTextOk":"This name is available","alertTextLoad":"Validating, please wait"},"validate2fields":{"alertText":"Please input HELLO"}};}};virb.$.validationEngineLanguage.newLang();})(jQuery);;(function($){$document=$(document);$window=$(window);$.overlay={init:function(){$overlay=$('#overlay');if(!$overlay.length){$('body').prepend('<div id="overlay"></div>').prepend('<div id="overlay-wrapper"><a href="" id="overlay_close" title="x"><span id="overlay-close-wrap"><span id="overlay-close-x">&times;</span><span id="overlay-close-clip"></span></span></a><div id="overlay-message"></div><div id="overlay-content"></div></div>');$overlay=$('#overlay');$overlay.css({opacity:$overlay.css('opacity')});$overlayWrapper=$('#overlay-wrapper');$overlayContent=$('#overlay-content');$overlayMessage=$('#overlay-message');}
$ajaxMessage=$('#ajaxMessage');if(!$ajaxMessage.length){$('body').prepend('<div id="ajaxMessage"></div>');$ajaxMessage=$('#ajaxMessage').click(function(){virb.$.overlay.hideAjaxMessages();});}
$('#announcement.positive .modify.edit a').click(function(){$.submitAjax('data[Page][action]=updateNotification&data[Page][type]=:feature',{ok:$.overlay.finishHideAnnouncement});$('#announcement.positive').slideUp(function(){$(this).remove();});});$('#announcement.negative .modify.edit a').click(function(){$.submitAjax('data[Page][action]=updateNotification&data[Page][type]=',{ok:$.overlay.finishHideAnnouncement});$('#announcement.negative').slideUp(function(){$(this).remove();});});var docScroll;$(document).bind('ready scroll',function(){$.overlay.handleOverlayScroll();});},handleOverlayScroll:function(){docScroll=$(document).scrollTop();if(docScroll>=60){$('#admin #ajaxMessage').addClass('ajaxMessageFixedTop');}else{$('#admin #ajaxMessage').removeClass('ajaxMessageFixedTop');}},finishHideAnnouncement:function(result){},show:function(opts){$.overlay.init();delete $.overlay.callback;delete $.overlay.callbackParams;$overlayMessage.hide();$overlayContent.show();if(opts&&opts.type){$.overlay.opts=opts;if(opts.callback)
$.overlay.callback=opts.callback;if(opts.callbackParams)
$.overlay.callbackParams=opts.callbackParams;$.overlay.buildHtml(opts);}
$overlay.fadeIn("fast",function(){$overlayWrapper.show();$overlayWrapper.center();if(!opts.killTitleinside||false==opts.killTitleinside)
$overlayWrapper.find('.titleinside').attachTitleInside();});if(!opts||!opts.cancelHide)
this.attachHideEvents(opts.type);},hide:function(cancelCallback){this.hideAjaxMessages();try{$('body').validationEngine('hideAll');}catch(e){}
$(document).unbind('keyup');$(document).unbind('keydown');if($overlayWrapper.is(':visible'))
$overlayWrapper.hide();if($.overlay.opts.autohide!==null&&false===$.overlay.opts.autohide&&$.overlay.callback&&!cancelCallback){var params=false;if($.overlay.callbackParams){params=$.overlay.callbackParams;}
try{window[$.overlay.callback](params);}catch(err){$.overlay.callback(params);}}else{$overlay.fadeOut("fast",function(){if($.overlay.callback&&!cancelCallback){var params=false;if($.overlay.callbackParams){params=$.overlay.callbackParams;}
try{window[$.overlay.callback](params);}catch(err){$.overlay.callback(params);}}
$overlayContent.html('');});}
$('input').each(function(){$(this).removeAttr('tabindex');});},overlayMessage:function(type,message){if(message)
$('#overlay-message').html('<p>'+message+'</p>');$('#overlay-message').removeClass().addClass(type).show();$('#overlay-content').hide();if(type=='error'||type=='notice')
$('#overlay-content').show();},ajaxMessage:function(type,message){$.overlay.init();if(type=='processing'){this.hideAjaxMessages();}else if(type!='processing'){$('.ajaxMessage.processing').fadeOut(function(){$(this).remove();});}
clearTimeout(this.ajaxMessageTimeout);var $output=$('<div class="ajaxMessage '+type+'"><span class="message">'+message+'</span><a href="#" onclick="virb.$.overlay.hideAjaxMessages();" class="close"></a></div>');$output.prependTo($ajaxMessage).fadeIn();this.ajaxMessageTimeout=setTimeout(function(){$('.ajaxMessage.success').fadeOut(function(){$(this).remove();});},3000);},hideAjaxMessages:function(args){var animation='fadeOut';if(args&&args.animation){animation=args.animation;}
if(animation=='fadeOut'){$('.ajaxMessage').fadeOut(function(){$(this).remove();});}else if(animation='hide'){$(this).remove();}},attachHideEvents:function(type){$('#overlay-wrapper a#overlay_close').click(function(){if($overlayContent.is(':visible'))
$.overlay.hide(true);return false;});$document.keydown(function(event){if(event.keyCode==27)event.preventDefault();});$document.keyup(function(event){if(event.keyCode==27){$document.unbind('keyup');$.overlay.hide(true);event.preventDefault();event.stopPropagation();}else if(event.keyCode==13){$document.unbind('keyup');if(type&&(type=='alert'||type=='confirm'||type=='prompt')){$.overlay.hide();}}});},buildHtml:function(opts){var output='';$overlayWrapper.prop({className:''});if(opts.customClass)
$overlayWrapper.addClass(opts.customClass);if(opts.type=='custom'&&opts.html&&opts.html!=''){output=opts.html;}else{if(opts.type=='prompt')
output+='<form action="" onsubmit="virb.$.overlay.hide();return false;">';output+='<h1>'+opts.title+'</h1>';if(opts.description)
output+='<h2>'+opts.description+'</h2>';if(opts.type=='prompt'){var titleInside='';if(opts.titleInside)
titleInside='title="'+opts.titleInside+'" class="titleinside"';output+='<span class="field"><input id="promptValue" value="" '+titleInside+' /></span>';}
output+='<div id="form_submit" class="overlay_footer">';if(opts.type=='alert'||opts.type=='prompt'){output+='<input type="button" class="modify add bigger" value="OK" onclick="virb.$.overlay.hide(); return false;" />';}else{var promptText="Yes";if(opts.promptText)
promptText=opts.promptText;output+='<input type="button" class="modify add bigger" value="'+promptText+'" onclick="virb.$.overlay.hide(false); return false;" />';}
if(opts.type=='confirm'||opts.type=='prompt'){var cancelText="Cancel";if(opts.cancelText)
cancelText=opts.cancelText;output+='<input type="button" class="cancelForm modify edit bigger" value="'+cancelText+'" onclick="virb.$.overlay.hide(true); return false;" />';}
if(opts.type=='prompt')
output+='</form>';output+='</div>';}
$overlayContent.html(output);$overlayWrapper.center();}};$.fn.center=function(){return this.each(function(){$this=$(this);var posTop=$window.height()/2-$this.height()/2;var posLeft=$window.width()/2-$this.width()/2;if($this.height()<$window.height())
posTop+=$window.scrollTop();if($this.width()<$window.width())
posLeft+=$window.scrollLeft();$this.css({position:"absolute",top:posTop,left:posLeft});});};$.alert=function(opts){opts.type='alert';customClass='alert';if(opts.customClass)
customClass=customClass+' '+opts.customClass;opts.customClass=customClass;$.overlay.show(opts);};$.prompt=function(opts){opts.type='prompt';opts.customClass='prompt';$.overlay.show(opts);};$.confirm=function(opts){opts.type='confirm';if(opts.customClass)
opts.customClass+=' confirm';else
opts.customClass='confirm';$.overlay.show(opts);};virb.$.overlay=$.overlay;virb.$.alert=$.alert;virb.$.prompt=$.prompt;virb.$.confirm=$.confirm;$(function(){virb.$.overlay.init();});})(virb.$);;(function($){$.logout={init:function(){$('.logout').click(function(){$.confirm({title:'Are you sure you want to log out?',callback:$.logout.now});return false;});},now:function(){window.location.href='/logout';}};$.login={win:false,init:function(){$('.login').not('body.login').click(function(){$.login.show();return false;});$('#account-switcher').click(function(){$.login.accountSwitch();return false;});},show:function(args){$('input').each(function(){$(this).attr('tabindex','-10');});var showArgs={type:'custom',html:this.getLoginHtml(),customClass:'overlay-login',killTitleinside:true};if(args&&args.cancelHide)
showArgs.cancelHide=true;$('.formError').hide();$.overlay.show(showArgs);$('#overlay-wrapper .titleinside').attachTitleInside();$('#dataUserPassword').focus(function(){$this=$(this);$this.val('').addClass('focus').unbind('focus').changeInputType('password');document.getElementById('dataUserPassword').focus();setTimeout("document.getElementById('dataUserPassword').focus()",100);});$("#loginForm").validationEngine('attach',{onValidationComplete:function(){$.login.submit({redirect:true});},bindMethod:'bind'});},showReset:function(newModal){$('.formError').hide();if($.overlay){var showArgs={type:'custom',html:this.getResetHtml(),customClass:'overlay-login overlay-password-reset'};$.overlay.show(showArgs);}else{$overlayContent.html(this.getResetHtml());$overlayWrapper.addClass('overlay-password-reset');}
$('#overlay-wrapper .titleinside').attachTitleInside();$("#loginForm").validationEngine('attach',{onValidationComplete:function(){$.login.submit();},bindMethod:'bind'});return false;},showLogin:function(){$('.formError').hide();$overlayContent.html(this.getLoginHtml());$overlayWrapper.removeClass().addClass('overlay-login');$('#overlay-wrapper .titleinside').attachTitleInside();$("#loginForm").validationEngine('attach',{onValidationComplete:function(){$.login.submit({redirect:true});},bindMethod:'bind'});return false;},showOpenId:function(){$('.formError').hide();$overlayContent.html(this.getOpenIdHtml());$overlayWrapper.addClass('overlay-openid');$('#overlay-wrapper .titleinside').attachTitleInside();$("#openIdForm").validationEngine('attach',{onValidationComplete:function(){$.login.submitOpenId();},bindMethod:'bind'});return false;},submit:function(args){$('.titleinside').hideTitleInside();$.overlay.ajaxMessage('processing','Processing...');var dataString='';var formId='#loginForm';if(args&&args.formId){formId=args.formId;}
$(formId).find(':input').each(function(){var encodedValue=$.encodeHTML(this.value);dataString+=this.name+'='+encodedValue+'&';});$.ajax({type:"POST",url:"//"+window.location.host+"/services/ajax/post",data:dataString,dataType:'json',success:function(result){for(var key in result){if(result[key].stat=='ok'){if(result[key].response&&result[key].response.pages){if(result[key].redirect!=''){window.location.href=result[key].redirect;}else{$.login.showAccounts(result[key],false);}}else{$.overlay.ajaxMessage('success',result[key].message);if(result[key].response&&result[key].response.reset){$.overlay.hide(true);}else if(args&&args.redirect){if(result[key].redirect!=''){window.location.href=result[key].redirect;}else{window.location.href='/pages?login';}}}}else{$('.titleinside').showTitleInside();$.overlay.ajaxMessage('error',result[key].message);}
break;}}});},submitOpenId:function(){$.overlay.ajaxMessage('processing','Processing...');var dataString='';$("#openIdForm").find(':input').each(function()
{dataString+=this.name+'='+this.value+'&';});window.open('/openid/start?'+dataString,'openid_popup','width=790,height=580');},handleOpenIdResponse:function(result){return false;if(result.OpenId.stat=="ok"){if(result.OpenId.code==12){$.overlay.hideAjaxMessages();var accounts=$.parseJSON(result.OpenId.response);$overlayContent.html(this.getAccountsHtml(result.OpenId,accounts.is_logged_in,"openid"));$overlayContent.show();$overlayWrapper.attr({'class':'overlay-accounts'});}else{$.overlay.ajaxMessage('success',result.OpenId.message);window.location.href=$.getHref(true);}}else{$.overlay.ajaxMessage('error',result.OpenId.message);}},handleLoginMultiple:function(result){return false;if(result.stat=="ok"){if(result.code==1){$.overlay.hideAjaxMessages();$overlayContent.html(this.getAccountsHtml(result,false,"openid"));$overlayContent.show();$overlayWrapper.attr({'class':'overlay-accounts'});}else{$.overlay.ajaxMessage('success',result.OpenId.message);window.location.href=$.getHref(true);}}else{$.overlay.ajaxMessage('error',result.OpenId.message);}},accountSwitch:function(){$.overlay.ajaxMessage('processing','Loading accounts...');$.submitAjax('data[User][action]=getSites',{ok:function(result){$.login.showAccounts(result,true);}});},showAccounts:function(accounts,switchAcct){$('.formError').hide();$.overlay.hideAjaxMessages();$.overlay.show({type:'custom',html:$.login.getAccountsHtml(accounts,switchAcct),customClass:'overlay-accounts'});return false;},getAccountsHtml:function(result,switchAcct,type){var html='';if(switchAcct)
html+='<h1>Switch to a different Virb site:</h1>';else
html+='<h1>Choose a Virb site to manage:</h1>';html+='<form action="" id="loginForm" onsubmit="$.login.submit({redirect: true});return false;" method="post">';html+='<input type="hidden" name="data[User][action]" value="loginByPageId" />';html+='<input type="hidden" name="data[User][page_id]" id="dataLoginPageId" value="" />';html+='</form>';html+='<ul>';var accounts=result.response.pages;for(var i in accounts){var page=accounts[i];var rowClass='';var rowText='<span>Log In &rarr;</span>';if(i==0)
rowClass+=' top';if(page.is_logged_in&&page.is_logged_in!='false'){rowClass+=' loggedin';rowText='<span>Logged In</span>';}
html+='<li class="'+rowClass+'"><a href="" id="page_id_'+page.id+'" onclick="$(\'#dataLoginPageId\').val(\''+page.id+'\');$.login.submit({redirect: true});return false;"><img src="'+page.site_icon+'" />'+page.display_name+'<em> &mdash; http://'+page.site_url+'</em>'+rowText+'</a></li>';}
html+='</ul>';return html;},getLoginHtml:function(){var html='';html+='<form action="" id="loginForm" onsubmit="return false;" method="post">';html+='<input type="hidden" name="data[User][action]" value="globalLogin" />';html+='<input type="hidden" name="data[User][type]" value="virb" />';html+='<p><span class="field"><input id="dataUserEmail" type="input" name="data[User][email]" tabindex="1" class="validate[email] titleinside" title="Email Address" value="Email Address" autocomplete="off" /></span></p>';html+='<p><span class="field password">';html+='<input id="dataUserPassword" type="text" name="data[User][password]" tabindex="2" class="validate[required] titleinside" title="Password" value="" autocomplete="off" />';html+='<a href="#reset" onclick="$.login.showReset();return false;">Forgot your password?</a>';html+='</span></p>';html+='<div id="form_submit">';html+='<a href="/signup" alt="Sign Up Now">Sign Up Now</a>';html+='<input type="submit" class="submit link green rounded_5" name="submit" tabindex="4" value="Log In" />';html+='<label class="remember" for="dataUserRemember"><input id="dataUserRemember" type="checkbox" name="data[User][remember_me]" checked="checked" tabindex="3" />';html+='Stay Logged In</label>';html+='</div>';html+='</form>';return html;},getResetHtml:function(){var html='';html+='<form action="" id="loginForm" onsubmit="return false;" method="post">';html+='<h1>Forgot your password?&nbsp;&nbsp;We\'ll email you a link to reset it:</h1>';html+='<input type="hidden" name="data[User][action]" value="passwordResetRequest" />';html+='<p><span class="field"><input id="dataUserEmail" type="input" name="data[User][email]" value="Email Address" class="titleinside" title="Email Address" /></span></p>';html+='<div id="form_submit"><input type="submit" class="submit link green rounded_5" value="Email Me" />';html+='</form>';return html;},getOpenIdHtml:function(){var html='';html+='<form action="" id="openIdForm" onsubmit="return false;" method="post">';html+='<h1>Log in to manage your site, or <a href="#signup" onclick="window.location.href=\'/signup\';return false;">sign up</a> for your free trial.</h1>';html+='<p><span class="field"><input id="dataUserOpenId" type="input" name="data[User][openid]" tabindex="1" class="validate[required] titleinside" title="Your OpenID..." value="Your OpenID..." /></span></p>';html+='<div id="form_submit"><input type="submit" tabindex="3" value="Log In" /></div>';html+='<span id="remember_me"><input id="dataUserRemember" type="checkbox" name="data[User][remember_me]" checked="checked" tabindex="2" />';html+='<label for="dataUserRemember">Remember login on this computer</label></span>';html+='<div class="overlay_footer">';html+='or <a href="#login" onclick="$.login.showLogin();return false;">log in with other services</a>';html+='</div>';html+='</form>';return html;}};virb.$.logout=$.logout;virb.$.login=$.login;$(function(){virb.$.logout.init();virb.$.login.init();});})(virb.$);;(function($){$.forms={submitCoords:{},submitPadding:{},submitInitialized:false,objs:{},updatedInputs:[],init:function(){this.attachTextareaExpand('textarea.expand');this.attachInputChange(':input');$('.delete-item').attachDelete();$('form').submit(function(){$.preventNav(false);$('.titleinside').hideTitleInside();if($(this).hasClass('validationEngine')){var result=$(this).validationEngine('validate');if(false==result){$('.titleinside').showTitleInside();}
return result;}
$('input[type=file]').prop('disabled',true).val('');});$('.saveForm').click(function(){$.forms.saveForm($(this));return false;});$('.saveItem').click(function(){$.forms.saveItem($(this));return false;});$('form .article select,form #services select, form .select select').attachSelect();},attachInputChange:function(selector){selector=selector+'[id!=themeCategories]';$(selector).unbind('change').change(function(event){$.forms.inputChanged($(this));});},attachTextareaExpand:function(selector){$this=$(this);$(selector).each(function(){$this=$(this);if($this.val()!=''&&$this.val()!=$.data(this,'title')){this.rows='6';}});$(selector).focus(function(){if(this.rows=='1'){this.rows='6';}});$(selector).blur(function(){if($this.val()==''||$this.val()==$.data(this,'title')){this.rows='1';}});},submitResult:function(result){if(result==false){$('.titleinside').showTitleInside();}
return result;},inputChanged:function($inputObj){if($inputObj.hasClass('autosave')){this.saveInput($inputObj);}
else{$.preventNav(true);this.updatedInputs[$inputObj.attr('name')]=$inputObj;}},saveItem:function($callbackObj){$.overlay.ajaxMessage('processing','Processing...');params=$.parseJSON($callbackObj.attr('params'));$('#'+params._handler+'_'+params.id).addClass('savedItem');dataString='';for(var i=0;i<params.length;i++){dataString+='data['+params._handler+']['+i+']='+params[i]+'&';}
if($callbackObj.attr('type')=='checkbox'){dataString+=$callbackObj.attr('name')+'='+$callbackObj.prop('checked')+'&';}
else
{dataString+=$callbackObj.attr('name')+'='+$.encodeHTML($callbackObj.val())+'&';}
$.ajax({type:"POST",url:"/services/ajax/post",data:dataString,dataType:'json',success:function(result){for(var key=0;i<result.length;i++){if(result[key].stat=='ok'){$.overlay.ajaxMessage('success',result[key].message);$('#'+params._handler+'_'+params.id).removeClass('deletedItem');if(params.callback){try
{window[params.callback](result[key].response);}
catch(err){var fn=new Function("response","return "+params.callback+"(response);");fn(result[key].response);}}}
else
{$.overlay.ajaxMessage('error',result[key].message);$('#'+params._handler+'_'+params.id).removeClass('savedItem');}}}});},deleteObj:function($deleteObj){$.overlay.ajaxMessage('processing','Processing...');var self=this;var refresh=$deleteObj.data('refresh')?true:false;var callback=$deleteObj.data('callback')?$deleteObj.data('callback'):false;var deleteSelector='#'+$deleteObj.data('handler').slugify('-_')+'_'+$deleteObj.data('id');var dataObj={model:$deleteObj.data('handler'),params:{id:$deleteObj.data('id'),action:'delete'}};if($deleteObj.data('selector')){deleteSelector=$deleteObj.data('selector');}
$(deleteSelector).addClass('deletedItem');virb.log('$.forms.deleteObj()');virb.log(dataObj);$.submitAjax(dataObj,{ok:function(result){$.overlay.ajaxMessage('success',result.message);$(deleteSelector).removeClass('savedItem');virb.log('$.event.trigger(delete.'+self.fromHandler(dataObj.model)+')');$.event.trigger('delete.'+self.fromHandler(dataObj.model)+'',[dataObj.params.id]);if(refresh){window.location.href=refresh;}},fail:function(result){$.overlay.ajaxMessage('error',result.message);$(deleteSelector).removeClass('deletedItem');}});},toHandler:function(toHandler){handlerSplit=toHandler.split('.');handlerSplit[handlerSplit.length-1]=handlerSplit[handlerSplit.length-1].toClass();return handlerSplit.join('/');},fromHandler:function(fromHandler){handlerSplit=fromHandler.split('/');handlerSplit[handlerSplit.length-1]=handlerSplit[handlerSplit.length-1].toUnderscore();return handlerSplit.join('.');},saveInput:function($inputObj,hideMessages){params=$.parseJSON($inputObj.attr('params'));if(typeof hideMessages=='undefined'||false==hideMessages){$.overlay.ajaxMessage('processing','Saving...');}
var dataString='';virb.log($inputObj.prop('type'));virb.log($inputObj.attr('name'));if($inputObj.prop('type')=='checkbox'){dataString+=$inputObj.attr('name')+'='+$inputObj.prop('checked')+'&';}else{dataString+=$inputObj.attr('name')+'='+$.encodeHTML($inputObj.val())+'&';}
if(params.id){dataString+='data['+params._handler+'][id]='+params.id+'&';}
for(var i=0;i<params.length;i++){if(params[i]==params._handler||params[i]==params.action){continue;}
dataString+='data['+params._handler+']['+i+']='+params[i]+'&';}
dataString+='data['+params._handler+'][action]='+params.action;$.ajax({type:"POST",url:"/services/ajax/post",data:dataString,dataType:'json',success:function(result){$.each(result,function(key,value){if(value.stat=='ok'){if(typeof hideMessages=='undefined'||false==hideMessages){$.overlay.ajaxMessage('success',value.message);}
if(value.response&&value.response.callback){try{window[value.response.callback](value.response);}catch(err){var fn=new Function("response","return "+value.response.callback+"(response);");fn(value.response);}}}else{if(typeof hideMessages=='undefined'||false==hideMessages){$.overlay.ajaxMessage('error',value.message);}}});}});},saveForm:function($clickObj){$.overlay.ajaxMessage('processing','Saving...');var $parentForm=$clickObj.closest('form');var dataString='';$parentForm.find('.titleinside').hideTitleInside();$parentForm.find(':input').each(function(i){var $this=$(this);dataString+=$this.attr('name')+'='+$this.val()+'&';});$.submitAjax(dataString,{ok:function(result){if($parentForm.attr('callback')){$.callback($parentForm.attr('callback'),'');}
$parentForm.find('.titleinside').showTitleInside();$.overlay.ajaxMessage('success',result.message);$parentForm.find(':input[type=password]').val('');$.preventNav(false);}});return false;},getInputAction:function(inputObj){nameArray=this.splitInputName($(inputObj).attr('name'));return $(':input[name="'+nameArray[0]+'['+nameArray[1]+'][action]"]:first');},splitInputName:function(name){nameArray=name.split('[');for(var i=0;i<nameArray.length;i++){nameArray[i]=nameArray[i].replace(/]/ig,'');}
return nameArray;},unsetInputsByModel:function(model){$(':input').each(function(){var inputName=this.name;inputNameSplit=$.forms.splitInputName(inputName);if(inputNameSplit[1]==model){delete $.forms.updatedInputs[inputName];}});},initializeSubmit:function(){if(this.submitInitialized==true)
return true;this.submitInitialized=true;this.objs.formSubmit=$('#form_submit');this.objs.floatFormSubmit=$('#form_float_submit');this.submitCoords=this.objs.formSubmit.offset();this.submitPadding.top=this.objs.formSubmit.css('paddingTop').replace('px','')*1;if(this.submitCoords.top>$(window).height())
this.objs.floatFormSubmit.fadeIn();$(window).scroll(function(){var $this=$(this);if($this.height()+$this.scrollTop()>=$.forms.submitCoords.top+$.forms.submitPadding.top&&$.forms.objs.floatFormSubmit.is(':visible'))
$.forms.objs.floatFormSubmit.fadeOut('fast');else if($this.height()+$this.scrollTop()<$.forms.submitCoords.top+$.forms.submitPadding.top&&false==$.forms.objs.floatFormSubmit.is(':visible'))
$.forms.objs.floatFormSubmit.fadeIn('fast');});$(window).resize(function(){var $this=$(this);if($this.height()+$this.scrollTop()>=$.forms.submitCoords.top+$.forms.submitPadding.top&&$.forms.objs.floatFormSubmit.is(':visible'))
$.forms.objs.floatFormSubmit.fadeOut('fast');else if($this.height()+$this.scrollTop()<$.forms.submitCoords.top+$.forms.submitPadding.top&&false==$.forms.objs.floatFormSubmit.is(':visible'))
$.forms.objs.floatFormSubmit.fadeIn('fast');});}};$.fn.attachDelete=function(args){return this.each(function(){var $this=$(this);$this.unbind('click').click(function(event){var $deleteObj=$(this);var confirmArgs={title:"Are you sure you want to "+this.title+"?",callback:function(){$.forms.deleteObj($deleteObj);}};$.confirm(confirmArgs);event.stopPropagation();});});};virb.$.forms=$.forms;$(function(){virb.$.forms.init();});})(jQuery);